# Week-04 HW
## 1. 在 Readme 中提供 instance 的 public IP，我會連線過去檢查，所以要保持主機是一直在啟動中
- 35.78.172.10
## 2. 什麼是 instance type?
在 AWS 中，Instance Type（實例類型）是用來定義 EC2（Elastic Compute Cloud）實例的硬體配置，包括 CPU、RAM、存儲空間和網絡性能等資源。Instance Type 不同，適用於不同的工作負載和應用場景。

1. 通用型（General Purpose）：
    - 適用場景：平衡 CPU、記憶體和網絡資源，適合多種工作負載。
    - Instance Type：
        - `t2`, `t3` 系列（可彈性調整性能，低成本）
        - `m6g` 系列（較高性能的通用型）
    - 使用案例：Web 伺服器、小型資料庫、開發環境等。

2. 計算優化型（Compute Optimized）：
    - 適用場景：需要大量計算資源的應用，提供較高的 vCPU 性能。
    - Instance Type：
        - `c6g` 系列
    - 使用案例：批處理任務、高性能計算、遊戲伺服器等。

3. 內存優化型（Memory Optimized）：
    - 適用場景：內存密集型應用，對記憶體有大量需求。
    - Instance Type：
        - `r6g` 系列
    - 使用案例：大型資料庫、內存緩存（如 Redis）、內存分析等。

4. 存儲優化型（Storage Optimized）：
    - 適用場景：需要高性能存儲的應用，例如大量的讀寫操作。
    - Instance Type：
        - `i3` 系列
    - 使用案例：大數據處理、NoSQL 資料庫、高 I/O 需求的工作負載。

5. 加速計算型（Accelerated Computing）：
    - 適用場景：需要 GPU、FPGA 等硬體加速的應用。
    - Instance Type：
        - `p3` 系列（GPU 加速）
    - 使用案例：機器學習、圖形處理、科學計算。

## 3. 什麼是 Nginx？有哪些用途與特性？
Nginx 是一高性能的 Web 伺服器，具備反向代理、負載均衡和靜態資源服務等功能，廣泛應用於處理大量並發請求的網站和應用中。Nginx 具有以下用途與特性：

1. HTTP 伺服器與靜態資源服務：
    - Nginx 適合提供靜態內容（如 HTML、CSS、JavaScript 和圖片），擁有高效的資源處理能力。
    - 其事件驅動、非阻塞架構使它能夠處理大量並發連接，並在消耗較少資源的情況下提供穩定的性能。

2. 反向代理與負載均衡：
    - Nginx 常用於將客戶端請求代理到後端應用伺服器（如 Express、Django 等）。它能夠均衡分配請求到多個後端伺服器，實現負載均衡並減輕單個伺服器的壓力。
    - 支持多種負載均衡算法，如輪詢、最小連接數和 IP 哈希，並具有故障轉移和健康檢查功能，確保伺服器的高可用性。

3. SSL/TLS 支持與安全加密：
    - Nginx 支持 SSL/TLS 協議，可以輕鬆配置 HTTPS，為網站提供安全加密通信。
    - 它支持 SNI（服務名稱指示），根據請求的主機名使用不同的證書，滿足多域名的 SSL 要求。

4. 緩存與性能優化：
    - Nginx 支持緩存功能，能夠將後端伺服器的響應結果緩存起來，減少對後端伺服器的壓力並加速響應速度，特別適合需要反向代理和靜態文件分發的網站。

5. 擴展性與靈活配置：
    - Nginx 具有高度的擴展性，支持多種模組和第三方擴展。其配置文件簡潔且靈活，可以根據需求輕鬆調整伺服器行為。

## 4. pm2 套件是什麼？有什麼用處？
PM2 是 Node.js 的進程管理工具，專門用來管理和監控 Node.js 應用。它可以簡化應用的部署、管理和維護，提供高可用性、負載均衡、自動重啟等功能，達到在伺服器上運行 Node.js 應用時更加穩定和高效。
PM2 具有以下用途與特性：

1. 進程管理與應用自動重啟：
    - PM2 可以輕鬆管理 Node.js 應用的啟動、停止、重啟等操作，無論是單一服務還是多個微服務，均能通過 PM2 進行統一控制。
    - 當應用程式崩潰時，PM2 會自動重啟應用，確保服務的穩定運行。

2. 負載均衡與集群模式：
    - 支持將應用程序運行在多個 CPU 核心上，透過集群模式進行負載均衡，從而提升應用的處理性能。這使得 CPU 密集型應用能夠充分利用多核資源，處理更多並發請求。

3. 日誌管理與錯誤追蹤：
    - 自帶完善的日誌管理功能，可以集中管理應用的日誌輸出，透過 `pm2 logs` 命令查看應用運行狀況和錯誤信息，以便於進行錯誤追蹤和性能調優。

4. 進程監控與健康檢查：
    - 提供實時監控功能，顯示應用的 CPU、記憶體使用情況等運行狀態，並通過 `pm2 monit` 命令監控資源消耗和性能。
    - 隨時了解應用健康狀況，及時發現並解決問題。

5. 零停機時間重載與開機自啟動：
    - 支持「零停機重載」（Zero-Downtime Reload），可以在應用更新時不間斷服務，確保用戶無感知的情況下完成升級。
    - 可以配置開機自啟動，確保伺服器重啟後應用自動運行。

6. 簡單的命令行操作與擴展性：
    - 透過簡潔的命令行界面操作，例如 `pm2 start`、`pm2 stop` 和 `pm2 restart`，即可完成對應用的管理，操作簡單高效。
    - 支持分佈式應用的集群管理，能夠將應用擴展至多個伺服器，確保應用的擴展性和靈活性。

## 5. 步驟 9 中提到的 `proxy` 是什麼意思？為什麼要透過 Nginx 來 `proxy` 到 Express 開發的 Web Server?
Proxy（代理）是一種在網絡通信中間的一個中介服務器，用來轉發客戶端的請求給後端伺服器，並將後端伺服器的響應結果返回給客戶端。這種技術在網絡架構中經常用來提高安全性、性能，或對流量進行管理。
代理的類型如下：

1. 正向代理：
    - 客戶端通過代理伺服器發送請求到互聯網。代理伺服器幫助客戶端隱藏自身，常用於訪問外部網絡或加強隱私保護。

2. 反向代理：
    - 客戶端將請求發送到代理伺服器，然後代理伺服器再將請求轉發給後端的服務。反向代理幫助後端伺服器隱藏自身，並進行負載均衡、緩存等操作。

### 為什麼要透過 Nginx 來 proxy 到 Express 開發的 Web Server？
Nginx 作為反向代理伺服器，可以為後端的 Express 應用程序提供許多好處：

1. 負載均衡：
    - 當一個 Web 有多個伺服器時，Nginx 可以分配請求到不同的後端伺服器，達到負載均衡的效果。這樣可以減少單一伺服器的壓力，提升應用的穩定性和性能。

2. 處理靜態文件：
    - Nginx 可以更高效地處理靜態文件（如 HTML、CSS、圖片等），減輕 Express 伺服器的壓力。

3. 安全性：
    - Nginx 可以作為應用的第一道防線，隱藏後端 Express 應用的實際 IP 和端口，減少攻擊者直接訪問後端伺服器的機會。
    - 它可以通過 SSL/TLS 提供 HTTPS 加密通信，保護用戶數據免受中間人攻擊。

4. 高效的並發處理：
    - Express 是基於單執行緒的模型，如果遇到高並發場景時，可能無法高效處理大量同時到來的請求。Nginx 則採用了事件驅動的非阻塞架構，可以非常高效地處理大量並發連接，避免因為大量請求直接傳入 Express 而造成崩潰。

5. 反向代理多個應用：
    - 若在同一個伺服器上運行多個應用，Nginx 可以根據不同的域名或 URL 將請求分發到不同的後端應用。
    - 例如，可以有多個 Express 應用運行在不同的端口上，Nginx 可以根據請求的路徑或域名將流量代理到相應的應用。

6. 負責端口 80/443：
    - 在生產環境中，標準的 HTTP (S) 流量會通過 80 或 443 端口傳輸，而這些端口通常需要特權訪問（需要 root 權限）。讓 Nginx 監聽這些端口並處理外部請求，然後將其轉發到 Express 伺服器運行的非特權端口（如 3000）。

7. 緩存：
    - Nginx 可以對一些靜態資源或頻繁訪問的 API 請求進行緩存，以提高響應速度並減少對後端伺服器的壓力。

8. Sticky Sessions（會話保持）：
    - Sticky Sessions 這技術能夠保證同一個用戶的所有請求都會被路由到同一個後端伺服器上，而不會在不同伺服器之間切換。
    - 在負載均衡中，Nginx 可以透過 `ip_hash`或 Cookie機制來實現 Sticky Sessions，確保用戶在多伺服器架構中不會丟失 session。

## 6. 在 readme 中提供步驟 9 的 Nginx 設定檔
```
server{
        listen 80 default_server;
        listen [::]:80 default_server;
        server_name 35.78.172.10;

        location / {
        proxy_pass http://localhost:3000; 
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        }
}
```

## 7. Security Group 是什麼？用途為何？有什麼設定原則嗎？
Security Group 是 AWS EC2 中的虛擬防火牆，用來控制進出 EC2 Instance 的網絡流量。它定義了一組規則，用來允許或拒絕指定端口、IP 地址範圍或協議的流量，從而保護 EC2 Instance 免受未授權的訪問。

### Security Group 的用途：
1. 控制入站和出站流量：
    - Security Group 用來限制哪些流量可以進入 EC2 Instance，以及哪些流量可以從實例發出。這能夠確保 EC2 Instance 只接收和發送授權的流量，提供基礎的網絡安全控制。

2. 保護 EC2 實例的安全：
    - Security Group 是伺服器的虛擬防火牆，能防止未經授權的訪問，減少網絡攻擊風險，確保應用的安全性。

3. 管理多個應用的網絡隔離：
    - 可以為不同的應用分別設置不同的 Security Group，這樣每個應用都可以有專屬的安全規則，從而有效隔離應用之間的網絡訪問。

4. 動態調整安全規則：
    - 當應用的訪問需求發生變化時，Security Group 允許隨時修改規則，這些更改會立即生效，無需中斷服務或重啟實例，確保安全管理靈活性。

### Security Group 的設定規則：

1. 最小權限原則：
    - 僅允許必要的端口和 IP 範圍訪問 EC2 實例。例如，開放 HTTP（端口 80）或 HTTPS（端口 443）給 Web 伺服器，同時限制 SSH（端口 22）僅供授權的 IP 使用。

2. 入站和出站流量獨立控制：
    - 入站和出站流量需要分別設置規則，允許的入站請求不會自動允許相應的出站流量，因此可以針對不同方向的流量進行精細化控制。

3. 允許規則：
    - Security Group 僅支持設置允許規則，所有未顯式允許的流量會被默認拒絕。

4. 基於 IP 地址或範圍設置規則：
    - 可以基於具體的 IP 地址或 IP 範圍來設置訪問控制，例如，允許來自特定辦公網絡的流量，阻止其他外部來源的訪問。

5. 協議和端口範圍的靈活設置：
    - Security Group 允許針對特定的協議（如 TCP、UDP）和端口範圍來設置訪問規則，以滿足應用的不同網絡需求。

## 8. 什麼是 sudo? 為什麼有的時候需要加上 sudo，有時候不用？
`sudo` 是 Linux 和類 Unix 系統中的一個命令，它的全稱是 "superuser do"。當你在命令行中使用 `sudo` 時，以**超級用戶**（root） 的權限來執行命令。root 是系統中的最高權限賬戶，擁有對系統的完全控制權，可以執行所有操作。

### 需要 sudo 的情況：
1. 修改系統設置或文件：
    - 修改系統配置文件、安裝軟件包、管理網絡設置等操作通常需要 `sudo`，因為這些操作涉及系統的關鍵部分，只有超級用戶才有權限進行修改。
    - 例如，安裝或更新軟件：
```bash
sudo apt update
sudo apt install nginx
```
2. 訪問受限的系統文件或目錄：
    - 系統中的某些文件和目錄對普通用戶是只讀的，無法進行修改或寫入操作。如果要更改這些文件，則需要 `sudo` 來獲得超級用戶權限。例如，修改 `/etc/hosts` 文件：
```bash
sudo nano /etc/hosts
```
3. 啟動 / 停止系統服務：
    - 啟動、停止或重啟系統服務（如 Nginx、MySQL 等）通常需要 `sudo`，因為這些服務運行在系統層級，普通用戶無法直接操作。
```bash
sudo systemctl restart nginx
```
### 為什麼有時候不需要 sudo？
1. 普通用戶權限足夠的操作：
    - 當執行普通用戶可以操作的命令時，無需使用 `sudo`。例如，操作自己的文件、進行目錄導航、創建非系統文件等操作，普通用戶權限就足夠了。
    - 例如，創建一個目錄：
```bash
mkdir myfolder
```
2. 不涉及系統敏感設置：
    - 如果只是在用戶空間下進行操作，如修改自己的配置文件、編輯一般文檔、運行普通應用程式，這些操作不會影響系統安全，因此不需要超級用戶權限。
    - 例如，運行一個普通的 Node.js 應用：
```bash
node app.js
```
## 9. Nginx 的 Log 檔案在哪裡？你怎麼找到的？怎麼看 Nginx 的 Log？

Nginx 的 Log 檔案在 `/var/log/nginx/` 裡面，我是利用 `sudo vim /ect/nginx/nginx.conf` 來查看 Nginx 的 config 文件。

如何查看 Nginx 的 Log？
要查看 Nginx 的日誌，可以使用命令行工具，如 `cat`、`less`、`tail` 等。
1. 查看 `access.log`：
- 用於查看 Nginx 接收的 HTTP 請求和相關信息。
```bash
cat /var/log/nginx/access.log
```
- 只查看最近幾行請求記錄：
```bash
tail -n 50 /var/log/nginx/access.log
```
- 實時查看請求的日誌（即時更新）：
```bash
tail -f /var/log/nginx/access.log
```
## 10. 其他你在過程中遭遇的問題，有找到解答就記錄下來，沒有可以把問題放著，下次上課討論。如果沒有遇到任何問題，也可以回答「無」
1. 一開始在架設 EC2 時，意外將 Outbound rules 刪除，導致無法正確連上 EC2 Instance，後來把它新增回來就沒問題了。
2. `pm2 start app.js` 後無法讓 server 保持連線，解法是要先 `npm install`。

## 11. 列出完成本作業時參考的資料
1. chatGPT
2. [聊聊關於基本的 nginx reverse proxies and nodejs Express web server](https://medium.com/%E5%89%8D%E7%AB%AF%E5%A3%B9%E5%85%A9%E4%B8%89%E4%BA%8B/%E8%81%8A%E8%81%8A%E9%97%9C%E6%96%BC%E5%9F%BA%E6%9C%AC%E7%9A%84-nginx-reverse-proxies-and-nodejs-express-web-server-2a1c8e7e7de1)
3. [[教學][Ubuntu 架站] 在 Ubuntu 22.04 安裝 Nginx 網頁伺服器，並架設多個網站（多網域）](https://ui-code.com/archives/667)
4. [使用 pm2 管理 Node.js 服務](https://ithelp.ithome.com.tw/articles/10220480)